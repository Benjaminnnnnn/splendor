import {
  AchievementCatalogEntry,
  AchievementCriterion,
  AchievementStatKey,
} from '../types/user';

export const achievementCodes = [
  'first_game',
  'first_win',
  'marathon_20',
  'marathon_50',
  'card_collector',
  'card_mogul',
  'winner_10',
  'prestige_hunter',
  'prestige_hoarder',
  'speedrunner',
  'swift_victory',
  'noble_courtier',
  'noble_diplomat',
  'gem_specialist',
  'consistent_winner',
] as const;

export type AchievementCode = (typeof achievementCodes)[number];

export type AchievementCatalogEntryWithCode = AchievementCatalogEntry & {
  code: AchievementCode;
  criteria: AchievementCriterion[];
};

export const achievementsCatalog: AchievementCatalogEntryWithCode[] = [
  {
    code: 'first_game',
    name: 'First Game',
    description: 'Play your first game of Splendor.',
    category: 'milestone',
    icon: 'Flag',
    unlockType: 'threshold',
    criteria: [{ statKey: 'games_played', comparator: '>=', targetValue: 1 }],
    sortOrder: 10,
  },
  {
    code: 'first_win',
    name: 'First Win',
    description: 'Win your first game.',
    category: 'milestone',
    icon: 'EmojiEvents',
    unlockType: 'threshold',
    criteria: [{ statKey: 'games_won', comparator: '>=', targetValue: 1 }],
    sortOrder: 20,
  },
  {
    code: 'marathon_20',
    name: 'Marathoner I',
    description: 'Play 20 games.',
    category: 'milestone',
    icon: 'DirectionsRun',
    unlockType: 'threshold',
    criteria: [{ statKey: 'games_played', comparator: '>=', targetValue: 20 }],
    sortOrder: 30,
  },
  {
    code: 'marathon_50',
    name: 'Marathoner II',
    description: 'Play 50 games.',
    category: 'milestone',
    icon: 'Hiking',
    unlockType: 'threshold',
    criteria: [{ statKey: 'games_played', comparator: '>=', targetValue: 50 }],
    sortOrder: 40,
  },
  {
    code: 'card_collector',
    name: 'Card Collector',
    description: 'Purchase 50 development cards.',
    category: 'collection',
    icon: 'Style',
    unlockType: 'threshold',
    criteria: [{ statKey: 'total_cards_purchased', comparator: '>=', targetValue: 50 }],
    sortOrder: 50,
  },
  {
    code: 'card_mogul',
    name: 'Card Mogul',
    description: 'Purchase 100 development cards.',
    category: 'collection',
    icon: 'AutoAwesome',
    unlockType: 'threshold',
    criteria: [{ statKey: 'total_cards_purchased', comparator: '>=', targetValue: 100 }],
    sortOrder: 60,
  },
  {
    code: 'winner_10',
    name: 'Winner X',
    description: 'Win 10 games.',
    category: 'milestone',
    icon: 'MilitaryTech',
    unlockType: 'threshold',
    criteria: [{ statKey: 'games_won', comparator: '>=', targetValue: 10 }],
    sortOrder: 70,
  },
  {
    code: 'prestige_hunter',
    name: 'Prestige Hunter',
    description: 'Reach 18 prestige in a single game.',
    category: 'prestige',
    icon: 'Star',
    unlockType: 'threshold',
    criteria: [{ statKey: 'highest_prestige_score', comparator: '>=', targetValue: 18 }],
    sortOrder: 80,
  },
  {
    code: 'prestige_hoarder',
    name: 'Prestige Hoarder',
    description: 'Accumulate 200 lifetime prestige points.',
    category: 'prestige',
    icon: 'WorkspacePremium',
    unlockType: 'threshold',
    criteria: [{ statKey: 'total_prestige_points', comparator: '>=', targetValue: 200 }],
    sortOrder: 90,
  },
  {
    code: 'speedrunner',
    name: 'Speedrunner',
    description: 'Win a game in under 15 minutes.',
    category: 'speed',
    icon: 'Bolt',
    unlockType: 'threshold',
    criteria: [{ statKey: 'fastest_win_time', comparator: '<=', targetValue: 900 }],
    sortOrder: 100,
  },
  {
    code: 'swift_victory',
    name: 'Swift Victory',
    description: 'Win a game in under 10 minutes.',
    category: 'speed',
    icon: 'FlashOn',
    unlockType: 'threshold',
    criteria: [{ statKey: 'fastest_win_time', comparator: '<=', targetValue: 600 }],
    sortOrder: 110,
  },
  {
    code: 'noble_courtier',
    name: 'Noble Courtier',
    description: 'Acquire 10 nobles.',
    category: 'collection',
    icon: 'Groups',
    unlockType: 'threshold',
    criteria: [{ statKey: 'total_nobles_acquired', comparator: '>=', targetValue: 10 }],
    sortOrder: 120,
  },
  {
    code: 'noble_diplomat',
    name: 'Noble Diplomat',
    description: 'Acquire 25 nobles.',
    category: 'collection',
    icon: 'Diversity3',
    unlockType: 'threshold',
    criteria: [{ statKey: 'total_nobles_acquired', comparator: '>=', targetValue: 25 }],
    sortOrder: 130,
  },
  {
    code: 'gem_specialist',
    name: 'Gem Specialist',
    description: 'Win 5 games with a favorite gem type recorded.',
    category: 'meta',
    icon: 'Diamond',
    unlockType: 'composite',
    criteria: [
      { statKey: 'games_won', comparator: '>=', targetValue: 5 },
      // favorite_gem_type is a string; we treat presence as a boolean flag by requiring non-empty.
      { statKey: 'favorite_gem_type' as AchievementStatKey, comparator: '>=', targetValue: 1 },
    ],
    sortOrder: 140,
  },
  {
    code: 'consistent_winner',
    name: 'Consistent Winner',
    description: 'Maintain a 60% win rate over at least 10 games.',
    category: 'milestone',
    icon: 'Insights',
    unlockType: 'ratio',
    criteria: [
      {
        statKey: 'games_won',
        comparator: '>=',
        targetValue: 0.6,
        denominatorStatKey: 'games_played',
        minSampleSize: 10,
      },
    ],
    sortOrder: 150,
  },
];
